<!DOCTYPE html>
<html>
<head>
    <title>Speech Sample</title>
    <meta charset="utf-8" />
    <script src="speech.sdk.bundle.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Transub</title>
    <script defer src="https://use.fontawesome.com/releases/v5.0.8/js/all.js" integrity="sha384-SlE991lGASHoBfWbelyBPLsUlwY1GwNDJo3jSJO04KZ33K2bwfV9YBauFfnzvynJ" crossorigin="anonymous"></script>
    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom fonts for this template -->
    <link rel="stylesheet" href="vendor/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="vendor/simple-line-icons/css/simple-line-icons.css">
    <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Catamaran:100,200,300,400,500,600,700,800,900" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Muli" rel="stylesheet">

    <!-- Plugin CSS -->
    <link rel="stylesheet" href="device-mockups/device-mockups.min.css">

    <!-- Custom styles for this template -->
    <link href="css/new-age.min.css" rel="stylesheet">
    <link href="css/new-age.css" rel="stylesheet">
    <link href="css/transub.css" rel="stylesheet">

</head>
<body style="font-family:'Helvetica Neue',Helvetica,Arial,sans-serif; font-size:13px;" id="page-top">
    <nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
                <div class="container">
                  <a class="navbar-brand js-scroll-trigger" href="#page-top">Start Transub</a>
                  <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                    Menu
                    <i class="fa fa-bars"></i>
                  </button>
                  <div class="collapse navbar-collapse" id="navbarResponsive">
                    <ul class="navbar-nav ml-auto">
                      <li class="nav-item">
                        <a class="nav-link js-scroll-trigger" href="#speech">Speech to Text</a>
                      </li>
                      <li class="nav-item">
                        <a class="nav-link js-scroll-trigger" href="#features">Image to Text</a>
                      </li>
                      <li class="nav-item">
                        <a class="nav-link js-scroll-trigger" href="#contact">Contact</a>
                      </li>
                    </ul>
                  </div>
                </div>
    </nav>
    
    <div id="warning">
        <h1 style="font-weight:500;">Speech Recognition SDK not found.</h1>
        <h2 style="font-weight:500;">Please execute <code>npm run bundle</code> and reload.</h2>
    </div>
    <header class="masthead">
            <div class="container h-100">
              <div class="row h-100">
                <div class="col-lg-7 my-auto">
                  <div class="header-content mx-auto">
                    <h1 class="mb-5">New Age is an app landing page that will help you beautifully showcase your new mobile app, or anything else!</h1>
                    <a href="#speech" class="btn btn-outline btn-xl js-scroll-trigger">Start Now for Free!</a>
                  </div>
                </div>
                <div class="col-lg-5 my-auto">
                  <div class="device-container">
                    <div class="device-mockup iphone6_plus portrait white">
                      <div class="device">
                        <div class="screen">
                          <!-- Demo image for screen mockup, you can put an image here, some HTML, an animation, video, or anything else! -->
                          <img src="img/demo-screen-1.jpg" class="img-fluid" alt="">
                        </div>
                        <div class="button">
                          <!-- You can hook the "home button" to some JavaScript events or just remove it -->
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
    </header>


    <section class="speech bg-primary text-center" id="speech">
      <div class="container">
        <div class="row">
          <div class="col-md-12 mx-auto">
            <h2 class="section-heading">Turn speeches to text!</h2>
            
            <div id="content" style="display:none">
                    
                    <div class="col-md-6 mx-auto">
                        
                        <div class="input-group mb-3 col-6">
                                    <div class="input-group-prepend">
                                      <label class="input-group-text" for="inputGroupSelect01">Language</label>
                                    </div>
                                    <select class="custom-select" id="languageOptions">                                          
                                            <option value="ar-EG">Arabic - EG</option>
                                            <option value="ca-ES">Catalan - ES</option>
                                            <option value="da-DK">Danish - DK</option>
                                            <option value="da-DK">Danish - DK</option>
                                            <option value="de-DE">German - DE</option>
                                            <option value="en-AU">English - AU</option>
                                            <option value="en-CA">English - CA</option>
                                            <option value="en-GB">English - GB</option>
                                            <option value="en-IN">English - IN</option>
                                            <option value="en-NZ">English - NZ</option>
                                            <option value="zh-CN">Chinese - CN</option>
                                            <option value="en-US" selected="selected">English - US</option>
                                            <option value="es-ES">Spanish - ES</option>
                                            <option value="es-MX">Spanish - MX</option>
                                            <option value="fi-FI">Finnish - FI</option>
                                            <option value="fr-CA">French - CA</option>
                                            <option value="fr-FR">French - FR</option>
                                            <option value="hi-IN">Hindi - IN</option>
                                            <option value="it-IT">Italian - IT</option>
                                            <option value="ja-JP">Japanese - JP</option>
                                            <option value="ko-KR">Korean - KR</option>
                                            <option value="nb-NO">Norwegian - NO</option>
                                            <option value="nl-NL">Dutch - NL</option>
                                            <option value="pl-PL">Polish - PL</option>
                                            <option value="pt-BR">Portuguese - BR</option>
                                            <option value="pt-PT">Portuguese - PT</option>
                                            <option value="ru-RU">Russian - RU</option>
                                            <option value="sv-SE">Swedish - SE</option>
                                            <option value="zh-CN">Chinese - CN</option>
                                            <option value="zh-HK">Chinese - HK</option>
                                            <option value="zh-TW">Chinese - TW</option>                                      
                                    </select>
                        </div>  
                        <label class="custom-file-upload btn btn-outline-dark">
                                <input type="file" id="filePicker" accept=".wav"/ >
                                Upload Audio File
                        </label> 
                    </div>   

                <!--        <div class="input-group mb-3 col-6" id="inputSelection">
                                        <div class="input-group-prepend">
                                          <label class="input-group-text" for="inputGroupSelect01">Input</label>
                                        </div>
                                        <select class="custom-select" id="inputSource">                                          
                                          <option value="Mic" selected="selected">Microphone</option>
                                          <option value="File">Audio File</option>
                                        </select>
                        </div> -->
                    
                        <div class="form-group">
                                <textarea class="form-control"  id="phraseDiv" style="display: inline-block;"></textarea>
                                
                        </div>                        
                                    
                        
                                <button id="startBtn" disabled="disabled" type="button" class="btn btn-outline-dark"><i class="fas fa-microphone"></i></button>
                                <button id="stopBtn" disabled="disabled" type="button" class="btn btn-outline-dark">Stop</button>
                              
                            
                                
                        
                            
                            
                                
                        
                            
                           
                                
                                
                                        
                                        
                                            <span id="hypothesisDiv" style="width:0px;height:0px;display:block;"></span>
                                 
                            
                        
                            
                            <span id="statusDiv"></span>
                        
                    
                </div>
            
          </div>
        </div>
      </div>
    </section>

    <section class="features" id="features">
      <div class="container">
        <div class="section-heading text-center">
          <h2>Unlimited Features, Unlimited Fun</h2>
          <p class="text-muted">Check out what you can do with this app theme!</p>
          <hr>
        </div>
        <div class="row">
          <div class="col-lg-4 my-auto">
            <div class="device-container">
              <div class="device-mockup iphone6_plus portrait white">
                <div class="device">
                  <div class="screen">
                    <!-- Demo image for screen mockup, you can put an image here, some HTML, an animation, video, or anything else! -->
                    <img src="img/demo-screen-1.jpg" class="img-fluid" alt="">
                  </div>
                  <div class="button">
                    <!-- You can hook the "home button" to some JavaScript events or just remove it -->
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-8 my-auto">
            <div class="container-fluid">
              <div class="row">
                <div class="col-lg-6">
                  <div class="feature-item">
                    <i class="icon-screen-smartphone text-primary"></i>
                    <h3>Device Mockups</h3>
                    <p class="text-muted">Ready to use HTML/CSS device mockups, no Photoshop required!</p>
                  </div>
                </div>
                <div class="col-lg-6">
                  <div class="feature-item">
                    <i class="icon-camera text-primary"></i>
                    <h3>Flexible Use</h3>
                    <p class="text-muted">Put an image, video, animation, or anything else in the screen!</p>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-lg-6">
                  <div class="feature-item">
                    <i class="icon-present text-primary"></i>
                    <h3>Free to Use</h3>
                    <p class="text-muted">As always, this theme is free to download and use for any purpose!</p>
                  </div>
                </div>
                <div class="col-lg-6">
                  <div class="feature-item">
                    <i class="icon-lock-open text-primary"></i>
                    <h3>Open Source</h3>
                    <p class="text-muted">Since this theme is MIT licensed, you can use it commercially!</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="cta">
      <div class="cta-content">
        <div class="container">
          <h2>Stop waiting.<br>Start building.</h2>
          <a href="#contact" class="btn btn-outline btn-xl js-scroll-trigger">Let's Get Started!</a>
        </div>
      </div>
      <div class="overlay"></div>
    </section>

    <section class="contact bg-primary" id="contact">
      <div class="container">
        <h2>We
          <i class="fa fa-heart"></i>
          new friends!</h2>
        <ul class="list-inline list-social">
          <li class="list-inline-item social-twitter">
            <a href="#">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
          <li class="list-inline-item social-facebook">
            <a href="#">
              <i class="fa fa-facebook"></i>
            </a>
          </li>
          <li class="list-inline-item social-google-plus">
            <a href="#">
              <i class="fa fa-google-plus"></i>
            </a>
          </li>
        </ul>
      </div>
    </section>

    <footer>
      <div class="container">
        <p>&copy; Your Website 2018. All Rights Reserved.</p>
        <ul class="list-inline">
          <li class="list-inline-item">
            <a href="#">Privacy</a>
          </li>
          <li class="list-inline-item">
            <a href="#">Terms</a>
          </li>
          <li class="list-inline-item">
            <a href="#">FAQ</a>
          </li>
        </ul>
      </div>
    </footer>

    <!-- Bootstrap core JavaScript -->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Plugin JavaScript -->
    <script src="vendor/jquery-easing/jquery.easing.min.js"></script>

    <!-- Custom scripts for this template -->
    <script src="js/new-age.min.js"></script>





    <!-- SDK REFERENCE -->
    <script src="../../distrib/speech.sdk.bundle.js"></script>

    <!-- SDK USAGE -->
    <script>
        // On document load resolve the SDK dependency
        function Initialize(onComplete) {
            if (!!window.SDK) {
                document.getElementById('content').style.display = 'block';
                document.getElementById('warning').style.display = 'none';
                onComplete(window.SDK);
            }
        }
        
        // Setup the recognizer
        function RecognizerSetup(SDK, recognitionMode, language, format, subscriptionKey) {
            
            switch (recognitionMode) {
                case "Interactive" :
                    recognitionMode = SDK.RecognitionMode.Interactive;    
                    break;
                case "Conversation" :
                    recognitionMode = SDK.RecognitionMode.Conversation;    
                    break;
                case "Dictation" :
                    recognitionMode = SDK.RecognitionMode.Dictation;    
                    break;
                default:
                    recognitionMode = SDK.RecognitionMode.Conversation;
            }

            var recognizerConfig = new SDK.RecognizerConfig(
                new SDK.SpeechConfig(
                    new SDK.Context(
                        new SDK.OS(navigator.userAgent, "Browser", null),
                        new SDK.Device("SpeechSample", "SpeechSample", "1.0.00000"))),
                recognitionMode,
                language, // Supported languages are specific to each recognition mode. Refer to docs.
                format); // SDK.SpeechResultFormat.Simple (Options - Simple/Detailed)


            var useTokenAuth = false;
            
            var authentication = function() {
                if (!useTokenAuth)
                    return new SDK.CognitiveSubscriptionKeyAuthentication(subscriptionKey);

                var callback = function() {
                    var tokenDeferral = new SDK.Deferred();
                    try {
                        var xhr = new(XMLHttpRequest || ActiveXObject)('MSXML2.XMLHTTP.3.0');
                        xhr.open('GET', '/token', 1);
                        xhr.onload = function () {
                            if (xhr.status === 200)  {
                                tokenDeferral.Resolve(xhr.responseText);
                            } else {
                                tokenDeferral.Reject('Issue token request failed.');
                            }
                        };
                        xhr.send();
                    } catch (e) {
                        window.console && console.log(e);
                        tokenDeferral.Reject(e.message);
                    }
                    return tokenDeferral.Promise();
                }

                return new SDK.CognitiveTokenAuthentication(callback, callback);
            }();
            
            var files = document.getElementById('filePicker').files;
            if (!files.length) {
                return SDK.CreateRecognizer(recognizerConfig, authentication);
            } else {
                return SDK.CreateRecognizerWithFileAudioSource(recognizerConfig, authentication, files[0]);
            }
        }

        // Start the recognition
        function RecognizerStart(SDK, recognizer) {
            var obj;
            recognizer.Recognize((event) => {
                /*
                 Alternative syntax for typescript devs.
                 if (event instanceof SDK.RecognitionTriggeredEvent)
                */
                switch (event.Name) {
                    case "RecognitionTriggeredEvent" :
                        UpdateStatus("Initializing");
                        break;
                    case "ListeningStartedEvent" :
                        UpdateStatus("Listening");
                        break;
                    case "RecognitionStartedEvent" :
                    //UpdateRecognizedHypothesis(event.Result.Text, true);
                        UpdateStatus("Listening_Recognizing");
                        break;
                    case "SpeechStartDetectedEvent" :
                    //UpdateRecognizedHypothesis(event.Result.Text, true);
                        UpdateStatus("Listening_DetectedSpeech_Recognizing");
                        console.log(JSON.stringify(event.Result)); // check console for other information in result
                        break;
                    case "SpeechHypothesisEvent" :
                        UpdateRecognizedHypothesis(event.Result.Text, false);
                        console.log(JSON.stringify(event.Result)); // check console for other information in result
                        break;
                    case "SpeechFragmentEvent" :
                        UpdateRecognizedHypothesis(event.Result.Text, true);
                        console.log(JSON.stringify(event.Result)); // check console for other information in result
                        break;
                    case "SpeechEndDetectedEvent" :
                        OnSpeechEndDetected();
                        //UpdateRecognizedHypothesis(event.Result.Text, true);
                        UpdateStatus("Processing_Adding_Final_Touches");
                        console.log(event.Result); // check console for other information in result
                        break;
                    case "SpeechSimplePhraseEvent" :
                        obj = JSON.parse(JSON.stringify(event.Result, null, 3));
                        if(obj.DisplayText) {
                            UpdateRecognizedPhrase(obj.DisplayText);
                        }
                        
                        console.log(JSON.stringify(event.Result, null, 3));
                        break;
                    case "SpeechDetailedPhraseEvent" :
                        UpdateRecognizedPhrase(JSON.stringify(event.Result, null, 3));
                        break;
                    case "RecognitionEndedEvent" :
                    //UpdateRecognizedHypothesis(event.Result.Text, true);
                        OnComplete();
                        UpdateStatus("Idle");
                        console.log(JSON.stringify(event)); // Debug information
                        break;
                    default:
                        console.log(JSON.stringify(event)); // Debug information
                }
            })
            .On(() => {
                // The request succeeded. Nothing to do here.
            },
            (error) => {
                console.error(error);
            });
        }

        // Stop the Recognition.
        function RecognizerStop(SDK, recognizer) {
            // recognizer.AudioSource.Detach(audioNodeId) can be also used here. (audioNodeId is part of ListeningStartedEvent)
            recognizer.AudioSource.TurnOff();
        }
    </script>

    <!-- Browser Hooks -->
    <script>
        var startBtn, stopBtn, hypothesisDiv, phraseDiv, statusDiv;
        var languageOptions, formatOptions, recognitionMode, inputSource, filePicker;
        var SDK;
        var recognizer;
        var previousSubscriptionKey;
        var key = "64561257bc9f4a1c88897f25a61a7964";

        document.addEventListener("DOMContentLoaded", function () {
            createBtn = document.getElementById("createBtn");
            startBtn = document.getElementById("startBtn");
            stopBtn = document.getElementById("stopBtn");
            phraseDiv = document.getElementById("phraseDiv");
            hypothesisDiv = document.getElementById("hypothesisDiv");
            statusDiv = document.getElementById("statusDiv");
            //key = document.getElementById("key");
            languageOptions = document.getElementById("languageOptions");
            formatOptions = "Simple";
            inputSource = document.getElementById("inputSource");
            recognitionMode = "Conversation";
            filePicker = document.getElementById('filePicker');

            languageOptions.addEventListener("change", Setup);
            //formatOptions.addEventListener("change", Setup);
            //recognitionMode.addEventListener("change", Setup);
            phraseDiv.addEventListener("change", function () {
                
            });
           

            startBtn.addEventListener("click", function () {
                    Setup();
                    //hypothesisDiv.innerHTML = "";
                    phraseDiv.innerHTML = "";
                    RecognizerStart(SDK, recognizer);
                    startBtn.disabled = true;
                    stopBtn.disabled = false;
               
            });

            filePicker.addEventListener("change", function () {
                Setup();
                //hypothesisDiv.innerHTML = "";
                phraseDiv.innerHTML = "";
                RecognizerStart(SDK, recognizer);
                startBtn.disabled = true;
                stopBtn.disabled = false;
                filePicker.value = "";
            });

            stopBtn.addEventListener("click", function () {
                RecognizerStop(SDK, recognizer);
                startBtn.disabled = false;
                stopBtn.disabled = true;
            });

            Initialize(function (speechSdk) {
                SDK = speechSdk;
                startBtn.disabled = false;
            });
        });

        function Setup() {
            if (recognizer != null) {
                RecognizerStop(SDK, recognizer);
            }
            recognizer = RecognizerSetup(SDK, recognitionMode, languageOptions.value, SDK.SpeechResultFormat[formatOptions], key);
        }

        function UpdateStatus(status) {
            statusDiv.innerHTML = status;
        }

        function UpdateRecognizedHypothesis(text, append) {
            if (append) 
                hypothesisDiv.innerHTML += text + " ";
            else 
                hypothesisDiv.innerHTML = text + "\n";

            var length = hypothesisDiv.innerHTML.length;
            if (length > 403) {
                hypothesisDiv.innerHTML = "..." + hypothesisDiv.innerHTML.substr(length-400, length);
            }
        }

        function OnSpeechEndDetected() {
            stopBtn.disabled = true;
        }
        
        function UpdateRecognizedPhrase(json) {
            //hypothesisDiv.innerHTML = "";
            
            phraseDiv.innerHTML += "\n" + json ;
            phraseDiv.scrollTop = phraseDiv.scrollHeight;
        }

        function OnComplete() {
            startBtn.disabled = false;
            stopBtn.disabled = true;
        }
    </script>
</body>
</html>
